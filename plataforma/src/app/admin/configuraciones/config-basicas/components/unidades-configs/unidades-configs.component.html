<div class="text-end">
  <button type="button" class="btn btn-primary btn-sm"  data-bs-toggle="modal" data-bs-target="#basicModal"><i class="fa-solid fa-plus"></i></button>
</div>

<mat-label>Buscar: </mat-label>
<mat-form-field>
  <input autocomplete="off" class="form-control inputBorderSearch" matInput (keyup)="applyFilter($event)"  #input>
</mat-form-field>

<table mat-table [dataSource]="dataSource" class="table  align-middle table-striped table-hover">

  <ng-container matColumnDef="no">
    <th mat-header-cell *matHeaderCellDef class="text-center"> No </th>
    <td mat-cell *matCellDef="let n=index" class="text-center">{{n+1}}</td>
  </ng-container>

  <ng-container matColumnDef="unidad">
    <th mat-header-cell *matHeaderCellDef class="text-center"> Unidad </th>
    <td mat-cell *matCellDef="let n" class="text-center">{{n.unidad}}</td>
  </ng-container>

  <ng-container matColumnDef="fecha_inicio">
    <th mat-header-cell *matHeaderCellDef class="text-center"> Inicia </th>
    <td mat-cell *matCellDef="let n" class="text-center">{{n.fecha_inicio | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <ng-container matColumnDef="fecha_final">
    <th mat-header-cell *matHeaderCellDef class="text-center"> Finaliza </th>
    <td mat-cell *matCellDef="let n" class="text-center">{{n.fecha_final | date:'dd/MM/yyyy'}}</td>
  </ng-container>
  <ng-container matColumnDef="estado">
    <th mat-header-cell *matHeaderCellDef class="text-center"> Estado </th>
    <td mat-cell *matCellDef="let n" class="text-center">
      <span class="badge bg-success" *ngIf="n.estado=='1';else activoInactivo">Activo</span>
      <ng-template #activoInactivo>
        <span class="badge bg-danger">Inactivo</span>
      </ng-template>
    </td>
  </ng-container>

  <ng-container matColumnDef="acciones">
    <th mat-header-cell *matHeaderCellDef class="text-center"> Acciones </th>
    <td mat-cell *matCellDef="let u" class="text-center">
      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#EditUnidadModal"  (click)="buscarUnidadesArray(u.idUnidad)"><i class="fa-solid fa-pen-to-square"></i></button>
        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#EliminarUnidadModal" (click)="buscarUnidadesArray(u.idUnidad)"><i class="fa-solid fa-trash"></i></button>
    </td>
  </ng-container>
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  <!-- Row shown when there is no matching data. -->
  <tr class="mat-row" *matNoDataRow>
    <td class="mat-cell" colspan="4">No se encuentran datos con: "{{input.value}}"</td>
  </tr>
</table>
<mat-paginator [pageSize]="unidadesPorPagina" aria-label="Select page of users"></mat-paginator>
<!--modal Editar-->
<div class="modal fade" id="EditUnidadModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Nivel</h5>
        <button type="button" #cerrarEditarModal class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
    <form class="row g-3" [formGroup]="unidadForm" (ngSubmit)="editarUnidad(unidadIndividual.idUnidad)" autocomplete="off">
      <div class="modal-body">

        <div class="mb-3">
          <label for="floatingName">Nombre del Bimestre:</label>
          <input type="text" class="form-control" formControlName="unidad">
          <span>Nombre Actual: <b>{{unidadIndividual.unidad}}</b></span>
        </div>
        <div class="mb-3">
          <label for="floatingName">Fecha de Inicio:</label>
          <input type="date" class="form-control" formControlName="fecha_inicio">
          <span>Fecha de Inicio Actual: <b>{{unidadIndividual.fecha_inicio | date:'dd/MM/yyyy'}}</b></span>
        </div>
        <div class="mb-3">
          <label for="floatingName">Fecha de Finalización:</label>
          <input type="date" class="form-control" formControlName="fecha_inicio">
          <span>Fecha de Finalización Actual: <b>{{unidadIndividual.fecha_final | date:'dd/MM/yyyy'}}</b></span>
        </div>
        <div class="mb-3">
          <div *ngIf="unidadIndividual.estado==1; else switchOff">
            <input class="form-check-input" type="checkbox" role="switch" (change)="selectedCheck($event)" checked>
            <label class="form-check-label text-success" for="flexSwitchCheckChecked"> <b>Activo</b></label>
          </div>
          <ng-template #switchOff>
            <input class="form-check-input" type="checkbox" role="switch" (change)="noselectedCheck($event)">
            <label class="form-check-label text-danger" for="flexSwitchCheckChecked"> <b>Inactivo</b></label>
          </ng-template>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="submit" class="btn btn-primary"><i class="fa-solid fa-pen-to-square"></i> Editar</button>
      </div>
    </form>
    </div>
  </div>
</div>
<!--modal Eliminar-->
<div class="modal fade" id="EliminarUnidadModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Eliminar Unidad</h5>
        <button type="button" #cerrarEliminarModal class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">Si la Unidad está asignada a tareas, no será posible eliminarla. <b>Esa acción de concretarse no se puede deshacer</b></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" (click)="eliminarUnidad(unidadIndividual.idUnidad)"><i class="fa-solid fa-trash-can"></i> Eliminar</button>
      </div>
    </div>
  </div>
</div>
<!--Modal Crear-->
<div class="modal fade" id="basicModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Agregar Unidad</h5>
        <button type="button" #cerrarCrearModal class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form class="row g-3" [formGroup]="unidadForm" (ngSubmit)="crearUnidad()" autocomplete="off">
        <div class="modal-body">
          <div class="col-md-12">

            <div class="mb-3">
              <label class="form-label">Nombre del Bimestre</label>
              <input formControlName="unidad" type="text" class="form-control" [ngClass]="{ 'is-invalid': submitted && f.unidad.errors }">
            </div>

            <div class="mb-3">
              <label class="form-label">Fecha de Inicio</label>
              <input formControlName="fecha_inicio" type="date" class="form-control" [ngClass]="{ 'is-invalid': submitted && f.fecha_inicio.errors }">
            </div>

            <div class="mb-3">
              <label class="form-label">Fecha Final</label>
              <input formControlName="fecha_final" type="date" class="form-control" [ngClass]="{ 'is-invalid': submitted && f.fecha_final.errors }">
            </div>
          </div>
          <div class="alert alert-dark" role="alert">
            <i class="fa-solid fa-circle-exclamation"></i> Los Bimestres siempre se crearan Activos.
          </div>

        </div>
        <div class="modal-footer">
          <div class="text-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button type="submit" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Crear</button>
          </div>
        </div>
      </form>
  </div>
</div>
</div>
