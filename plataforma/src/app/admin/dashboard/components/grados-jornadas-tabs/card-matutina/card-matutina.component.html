<div class="text-end">
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop"><i class="fa-solid fa-plus"></i></button>
</div>
<mat-label>Buscar: </mat-label>
<mat-form-field>
  <input autocomplete="off" class="form-control inputBorderSearch" matInput (keyup)="applyFilter($event)"  #input>
</mat-form-field>
<div>
  <table mat-table [dataSource]="dataSource" class="table  align-middle table-striped table-hover">

    <ng-container matColumnDef="nombre_grado">
      <th mat-header-cell *matHeaderCellDef class="text-center"> Grado </th>
      <td mat-cell *matCellDef="let grado" class="text-center"><a routerLink="/admin/grado/{{grado.idGrado}}">{{grado.nombre_grado+', Sección: '+grado.seccion}} </a></td>
    </ng-container>

    <ng-container matColumnDef="seccion">
      <th mat-header-cell *matHeaderCellDef class="text-center"> Alumnos </th>
      <td mat-cell *matCellDef="let grado" class="text-center"> {{grado.Alumnos}} </td>
    </ng-container>

    <ng-container matColumnDef="nivel">
      <th mat-header-cell *matHeaderCellDef class="text-center"> Nivel </th>
      <td mat-cell *matCellDef="let grado" class="text-center"> {{grado.nivel}} </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef class="text-center"> Estado </th>
      <td class="text-center" mat-cell *matCellDef="let grado">
        <div *ngIf="grado.estatus=='1';else noActivo">
          <b><i class="fa-sharp fa-solid fa-check fa-lg text-success"></i></b>
        </div>
        <ng-template #noActivo>
          <b><i class="fa-solid fa-xmark fa-xl text-danger"></i></b>
        </ng-template>
      </td>
    </ng-container>

    <ng-container matColumnDef="idGrado">
      <th mat-header-cell *matHeaderCellDef> Acciones </th>
      <td mat-cell *matCellDef="let grado">
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#staticBackdropEditar" (click)="buscarGradoIndividual(grado.idGrado)"><i class="fa-solid fa-pen-to-square"></i></button>
        <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#consolidado" (click)="consolidado(grado.idGrado)"><i class="fa-solid fa-table"></i></button>
        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#staticBackdropEliminar" (click)="buscarGradoIndividual(grado.idGrado)"><i class="fa-solid fa-trash"></i></button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    <!-- Row shown when there is no matching data. -->
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">No se encuentran datos con: "{{input.value}}"</td>
    </tr>
  </table>
<mat-paginator [pageSize]="gradosPorPagina" aria-label="Select page of users"></mat-paginator>

<div  *ngIf="errorService.codigoError!=''">
  <div class="alert alert-warning alert-dismissible fade show" role="alert">
    {{errorService.codigoError+', No se puede Ejecutar Esta Acción'}}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</div>

</div>
<!--Modal Consolidado de Grado-->
<!-- Modal -->
<div class="modal fade" id="consolidado" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Cuadro Guía</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="imprimir-consolidado">
          <table class="table table-bordered">
            <thead>
              <th>No.</th>
              <th>Alumno</th>
              <th *ngFor="let curso of cursosConsolidado">{{curso.nombre_curso}}</th>
              <th>Final</th>
            </thead>
            <tr *ngFor="let c of notasCursoConsolidado">
              <td>{{c.nombres_alumno}}</td>
              <td>{{c.nota}}</td>
              <td>{{c.nombre}}</td>
            </tr>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary"><i class="fa-solid fa-print"></i> Imprimir</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Agregar Grado</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Nivel:</label>
          <select [class]="selectVacioNivel" name="nivel" [(ngModel)]="NivelSeleccionado" aria-label="Default select example" required>
            <option *ngFor="let niveles of nivelesModal;let i=index" value={{niveles.idNivel}}>{{niveles.nivel+', '+niveles.jornada}}</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Nombre del Grado</label>
          <input autocomplete="off" type="text" name="nombreGrado" [(ngModel)]="nombreGrado" [class]="gradoVacioError" id="exampleFormControlInput1" required>
        </div>

        <div class="mb-3">
          <label for="exampleFormControlInput1" name="seccion" class="form-label">Sección:</label>
          <select [class]="selectVacioSeccion" [(ngModel)]="SeccionSeleccionada" aria-label="Default select example" required>
            <option *ngFor="let seccion of seccionesModal;let i=index" value={{seccion.idSeccion}}>{{'Sección: '+seccion.seccion}}</option>
          </select>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="modalIngresar(NivelSeleccionado,SeccionSeleccionada)">Agregar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Editar-->
<div class="modal fade" id="staticBackdropEditar" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Editar Grado</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Nivel:</label>
          <select [class]="selectVacioNivel" name="nivel" [(ngModel)]="NivelSeleccionado" aria-label="Default select example" required>
            <option *ngFor="let niveles of nivelesModal;let i=index" value={{niveles.idNivel}}>{{niveles.nivel+', '+niveles.jornada}}</option>
          </select>
          <label>Nivel Actual: <b>{{gradoIndividual.nivel+', Matutina'}}</b></label>
        </div>

        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Nombre del Grado</label>
          <input autocomplete="off" type="text" name="nombreGrado" [(ngModel)]="gradoIndividual.nombre_grado" [class]="gradoVacioError" id="exampleFormControlInput1" required>
        </div>

        <div class="mb-3">
          <label for="exampleFormControlInput1" name="seccion" class="form-label">Sección:</label>
          <select [class]="selectVacioSeccion" [(ngModel)]="SeccionSeleccionada" aria-label="Default select example" required>
            <option *ngFor="let seccion of seccionesModal;let i=index" value={{seccion.idSeccion}}>{{'Sección: '+seccion.seccion}}</option>
          </select>
          <label>Sección Actual: <b>{{gradoIndividual.seccion}}</b></label>
        </div>
        <div>Grado Activo/Inactivo</div>
        <div class="form-check form-switch">
          <div *ngIf="gradoIndividual.estatus==1; else switchOff" >
            <input class="form-check-input" type="checkbox" (change)="selectedCheck($event)" role="switch" checked>
            <label class="form-check-label text-success" for="flexSwitchCheckChecked"><b>Activo</b></label>
          </div>
          <ng-template #switchOff>
            <input class="form-check-input" type="checkbox" (change)="noselectedCheck($event)" role="switch">
            <label class="form-check-label text-danger" for="flexSwitchCheckChecked"><b>Inactivo</b></label>
          </ng-template>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="submit" class="btn btn-primary" data-bs-dismiss="modal" (click)="EditGrado(gradoIndividual.idGrado,NivelSeleccionado,SeccionSeleccionada)">Editar</button>
      </div>
    </div>
  </div>
</div>

<!-- Eliminar -->
<div class="modal fade" id="staticBackdropEliminar" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Eliminar Grado</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Nombre del Grado</label>
          <input autocomplete="off" class="form-control" type="text" value="{{gradoIndividual.nombre_grado}}" id="exampleFormControlInput1" disabled>
        </div>
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Sección</label>
          <input autocomplete="off" class="form-control" type="text" value="{{gradoIndividual.seccion}}" id="exampleFormControlInput1" disabled>
        </div>
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Nivel</label>
          <input autocomplete="off" class="form-control" type="text" value="{{gradoIndividual.nivel}}"  id="exampleFormControlInput1" disabled>
        </div>

        <div class="alert alert-warning" role="alert">
          Si el Grado Posee Alumnos, no se podrá Eliminar
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" (click)="EliminarGrado(gradoIndividual.idGrado)">Eliminar</button>
      </div>
    </div>
  </div>
</div>
