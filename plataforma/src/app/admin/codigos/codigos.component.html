<main id="main" class="main">
  <div class="pagetitle">
    <h1>Códigos</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
        <li class="breadcrumb-item active">Códigos</li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <div class="d-flex">
              <h5 class="card-title">Estatus <span>| Listado Códigos</span></h5>
            </div>

            <!-- Filtro de búsqueda -->
            <mat-form-field>
              <label>Buscar</label>
              <input
                matInput
                autocomplete="off"
                class="form-control"
                (keyup)="applyFilter($event)"
                #input
              />
            </mat-form-field>

            <!-- Spinner de carga -->
            <div *ngIf="spinnerOn; else MostrarDataPerfilOverview">
              <app-loaderpeque></app-loaderpeque>
            </div>

            <!-- Tabla de códigos -->
            <!-- Tabla de códigos -->
<ng-template #MostrarDataPerfilOverview>
  <div style="overflow-x: auto;">
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      class="table align-middle table-striped table-hover"
    >
      <!-- Columna No -->
      <ng-container matColumnDef="no">
        <th mat-header-cell *matHeaderCellDef class="text-center" mat-sort-header>No</th>
        <td mat-cell *matCellDef="let c" class="text-center">{{ c.no }}</td>
      </ng-container>

      <!-- Columna Código -->
      <ng-container matColumnDef="codigo">
        <th mat-header-cell *matHeaderCellDef class="text-center" mat-sort-header>Código</th>
        <td mat-cell *matCellDef="let c" class="text-center">{{ c.codigo }}</td>
      </ng-container>

      <!-- Columna Tipo -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef class="text-center" mat-sort-header>Tipo</th>
        <td mat-cell *matCellDef="let c" class="text-center">{{ c.tipo }}</td>
      </ng-container>

      <!-- Columna Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef class="text-center" mat-sort-header>Estado</th>
        <td mat-cell *matCellDef="let c" class="text-center">
          <span class="badge bg-success" *ngIf="c.activo === '1'; else activoInactivo">
            Disponible para Usar
          </span>
          <ng-template #activoInactivo>
            <span class="badge bg-danger">Código en Uso</span>
          </ng-template>
        </td>
      </ng-container>

      <!-- Columna Editar -->
      <ng-container matColumnDef="editar">
        <th mat-header-cell *matHeaderCellDef class="text-center">Editar</th>
        <td mat-cell *matCellDef="let c" class="text-center">
          <button
            class="btn btn-primary btn-sm"
            data-bs-toggle="modal"
            data-bs-target="#EditCodigoModal"
            aria-label="Editar código"
            (click)="buscarCodigoArray(c.idCodigo)"
          >
            <i class="fa-solid fa-pen-to-square"></i>
          </button>
        </td>
      </ng-container>

      <!-- Filas de la tabla -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- Mensaje cuando no hay datos -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">No se encuentran datos con: "{{ input.value }}"</td>
      </tr>
    </table>
  </div>
</ng-template>


            <!-- Paginador -->
            <mat-paginator
              [pageSize]="codigoPorPagina"
              aria-label="Paginador de códigos"
            ></mat-paginator>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para editar código -->
    <div
      class="modal fade"
      id="EditCodigoModal"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="staticBackdropLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="staticBackdropLabel">Editar Código</h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="codigoInput" class="form-label">Código</label>
              <input
                autocomplete="off"
                type="text"
                [(ngModel)]="codigoIndividual.codigo"
                [class]="codigoVacioError"
                id="codigoInput"
                required
              />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Cerrar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
              (click)="EditCodigo(codigoIndividual.idCodigo)"
            >
              Editar
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
